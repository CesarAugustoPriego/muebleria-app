{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\cesar\\\\OneDrive\\\\Documentos\\\\GitHub\\\\muebleria-app\\\\frontend\\\\src\\\\pages\\\\CarritoPage.jsx\",\n  _s = $RefreshSig$();\n// src/pages/CarritoPage.jsx\nimport React, { useEffect, useState } from 'react';\nimport Navbar from '../components/Auth/Navbar';\nimport './CarritoPage.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function CarritoPage() {\n  _s();\n  var _metodos$find;\n  const [carrito, setCarrito] = useState(null);\n\n  // — DIRECCIONES —\n  const [direcciones, setDirecciones] = useState([]);\n  const [direccion, setDireccion] = useState({\n    nombre: '',\n    calle: '',\n    ciudad: '',\n    estado: '',\n    cp: '',\n    telefono: '',\n    referencia: ''\n  });\n  const [direccionGuardada, setDireccionGuardada] = useState(false);\n  const [mensajeDireccion, setMensajeDireccion] = useState('');\n\n  // — MÉTODOS DE PAGO —\n  const [metodos, setMetodos] = useState([]);\n  const [metodoPago, setMetodoPago] = useState('');\n  const [detallesPago, setDetallesPago] = useState({\n    numero: '',\n    expiracion: '',\n    cvv: '',\n    email: ''\n  });\n  const [pagoGuardado, setPagoGuardado] = useState(false);\n  const [mensajePago, setMensajePago] = useState('');\n\n  // — ESTADO GENERAL —\n  const [mensajeFinal, setMensajeFinal] = useState('');\n  const token = localStorage.getItem('token');\n  const API = 'http://localhost:4000/api';\n\n  // al montar: traemos carrito, direcciones y métodos\n  useEffect(() => {\n    // 1) Carrito\n    fetch(`${API}/carrito`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(r => r.json()).then(setCarrito).catch(console.error);\n\n    // 2) Direcciones\n    fetch(`${API}/direcciones`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(r => r.json()).then(dirs => {\n      setDirecciones(dirs || []);\n      if (dirs.length) {\n        const d = dirs[0];\n        setDireccion({\n          nombre: d.nombre_recibe,\n          calle: d.calle,\n          ciudad: d.ciudad,\n          estado: d.estado,\n          cp: d.cp,\n          telefono: d.telefono,\n          referencia: d.referencia || ''\n        });\n        setDireccionGuardada(true);\n        setMensajeDireccion('📦 Dirección cargada del servidor.');\n      }\n    }).catch(console.error);\n\n    // 3) Métodos de pago\n    fetch(`${API}/metodos`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(r => r.json()).then(mps => {\n      setMetodos(mps || []);\n      if (mps.length) {\n        const m = mps[0];\n        setMetodoPago(m.id.toString());\n        if (m.tipo === 'tarjeta') {\n          setDetallesPago({\n            numero: m.titular,\n            expiracion: '',\n            cvv: '',\n            email: ''\n          });\n        } else {\n          setDetallesPago({\n            numero: '',\n            expiracion: '',\n            cvv: '',\n            email: m.titular || ''\n          });\n        }\n        setPagoGuardado(true);\n        setMensajePago('💳 Método de pago cargado del servidor.');\n      }\n    }).catch(console.error);\n  }, []);\n  if (!carrito) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Cargando carrito\\u2026\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 24\n  }, this);\n\n  // — Funciones de carrito —\n  const cambiarCantidad = (id, qty) => {\n    fetch(`${API}/carrito/detalle/${id}`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        cantidad: qty\n      })\n    }).then(() => fetch(`${API}/carrito`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(r => r.json()).then(setCarrito)).catch(console.error);\n  };\n  const eliminarItem = id => cambiarCantidad(id, 0);\n\n  // — Total —\n  const total = carrito.detalles.reduce((sum, d) => sum + d.producto.precio_unitario * d.cantidad, 0);\n\n  // — Guardar dirección —\n  const guardarDireccion = async () => {\n    if (!direccion.nombre || !direccion.calle || !direccion.ciudad || !direccion.cp) {\n      return alert('Por favor completa nombre, calle, ciudad y código postal.');\n    }\n    try {\n      const res = await fetch(`${API}/direcciones`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          nombre_recibe: direccion.nombre,\n          calle: direccion.calle,\n          ciudad: direccion.ciudad,\n          estado: direccion.estado,\n          cp: direccion.cp,\n          telefono: direccion.telefono,\n          referencia: direccion.referencia\n        })\n      });\n      const body = await res.json();\n      if (!res.ok) throw new Error(body.msg || 'Error guardando dirección');\n      setDireccionGuardada(true);\n      setMensajeDireccion('📦 Dirección guardada en el servidor.');\n      // recargar lista\n      setDirecciones(ds => [...ds, body]);\n    } catch (e) {\n      alert('❌ ' + e.message);\n    }\n  };\n\n  // — Guardar método de pago / agregar nueva tarjeta —\n  const guardarMetodoPago = async () => {\n    if (!metodoPago) return alert('Selecciona un método de pago.');\n    // si seleccionó uno existente (id numérico), no creamos\n    if (!isNaN(+metodoPago)) {\n      setPagoGuardado(true);\n      setMensajePago('💳 Método de pago seleccionado.');\n      return;\n    }\n    // si métodoPago === 'nueva_tarjeta'\n    const {\n      numero,\n      expiracion,\n      cvv\n    } = detallesPago;\n    if (!numero || !expiracion || !cvv) {\n      return alert('Completa los datos de la tarjeta.');\n    }\n    const payload = {\n      tipo: 'tarjeta',\n      token_last4: numero.slice(-4),\n      titular: numero\n    };\n    try {\n      const res = await fetch(`${API}/metodos`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify(payload)\n      });\n      const body = await res.json();\n      if (!res.ok) throw new Error(body.msg || 'Error guardando método');\n      setPagoGuardado(true);\n      setMensajePago('💳 Tarjeta guardada en el servidor.');\n      setMetodos(ms => [...ms, body]);\n      setMetodoPago(body.id.toString());\n    } catch (e) {\n      alert('❌ ' + e.message);\n    }\n  };\n\n  // — Checkout —\n  const manejarPago = async () => {\n    if (!direccionGuardada || !pagoGuardado) {\n      return alert('Guarda tu dirección y método de pago antes de continuar.');\n    }\n    try {\n      var _direcciones$find;\n      const res = await fetch(`${API}/carrito/checkout`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          direccionId: (_direcciones$find = direcciones.find(d => d.nombre_recibe === direccion.nombre)) === null || _direcciones$find === void 0 ? void 0 : _direcciones$find.id,\n          metodoPagoId: isNaN(+metodoPago) ? null : +metodoPago\n        })\n      });\n      if (!res.ok) throw new Error('Error en checkout');\n      setMensajeFinal('✅ Tu compra se ha procesado correctamente.');\n    } catch (e) {\n      alert('❌ ' + e.message);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"carrito-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"\\uD83D\\uDED2 Tu Carrito\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 9\n      }, this), carrito.detalles.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Tu carrito est\\xE1 vac\\xEDo.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"carrito-items\",\n          children: carrito.detalles.map(d => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"carrito-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: `http://localhost:4000${d.producto.imagen_url}`,\n              alt: d.producto.nombre\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                children: d.producto.nombre\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"$\", d.producto.precio_unitario.toLocaleString(), \" MXN\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cantidad-control\",\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Cantidad:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 238,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  min: \"1\",\n                  value: d.cantidad,\n                  onChange: e => cambiarCantidad(d.id, +e.target.value || 1)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 239,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"eliminar\",\n                onClick: () => eliminarItem(d.id),\n                children: \"Eliminar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 243,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 19\n            }, this)]\n          }, d.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"direccion-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\uD83D\\uDCE6 Direcci\\xF3n de env\\xEDo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 253,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Nombre completo\",\n            value: direccion.nombre,\n            onChange: e => setDireccion({\n              ...direccion,\n              nombre: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Calle\",\n            value: direccion.calle,\n            onChange: e => setDireccion({\n              ...direccion,\n              calle: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Ciudad\",\n            value: direccion.ciudad,\n            onChange: e => setDireccion({\n              ...direccion,\n              ciudad: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Estado\",\n            value: direccion.estado,\n            onChange: e => setDireccion({\n              ...direccion,\n              estado: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"C\\xF3digo postal\",\n            value: direccion.cp,\n            onChange: e => setDireccion({\n              ...direccion,\n              cp: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"tel\",\n            placeholder: \"Tel\\xE9fono\",\n            value: direccion.telefono,\n            onChange: e => setDireccion({\n              ...direccion,\n              telefono: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Referencia (opcional)\",\n            value: direccion.referencia,\n            onChange: e => setDireccion({\n              ...direccion,\n              referencia: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"guardar-btn\",\n            onClick: guardarDireccion,\n            children: \"Guardar direcci\\xF3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 15\n          }, this), mensajeDireccion && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mensaje-confirmacion\",\n            children: mensajeDireccion\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 36\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"metodo-pago-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\uD83D\\uDCB3 M\\xE9todo de pago\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: metodoPago,\n            onChange: e => {\n              setMetodoPago(e.target.value);\n              setDetallesPago({\n                numero: '',\n                expiracion: '',\n                cvv: '',\n                email: ''\n              });\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              children: \"Selecciona un m\\xE9todo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 286,\n              columnNumber: 17\n            }, this), metodos.map(m => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: m.id,\n              children: m.tipo === 'tarjeta' ? `Tarjeta •••• ${m.token_last4}` : m.tipo === 'transferencia' ? `PayPal (${m.titular})` : m.tipo\n            }, m.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 19\n            }, this)), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"nueva_tarjeta\",\n              children: \"+ Agregar nueva tarjeta\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 15\n          }, this), metodoPago === 'nueva_tarjeta' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"N\\xFAmero de tarjeta\",\n              value: detallesPago.numero,\n              onChange: e => setDetallesPago({\n                ...detallesPago,\n                numero: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"MM/AA\",\n              value: detallesPago.expiracion,\n              onChange: e => setDetallesPago({\n                ...detallesPago,\n                expiracion: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"CVV\",\n              value: detallesPago.cvv,\n              onChange: e => setDetallesPago({\n                ...detallesPago,\n                cvv: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true), metodoPago !== 'nueva_tarjeta' && metodoPago !== '' && metodoPago !== 'efectivo' && /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Seleccionado: \", (_metodos$find = metodos.find(m => m.id.toString() === metodoPago)) === null || _metodos$find === void 0 ? void 0 : _metodos$find.tipo]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"guardar-btn\",\n            onClick: guardarMetodoPago,\n            children: \"Guardar m\\xE9todo de pago\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 15\n          }, this), mensajePago && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mensaje-confirmacion\",\n            children: mensajePago\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 31\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"resumen-carrito\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Total: $\", total.toLocaleString(), \" MXN\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"pago-btn\",\n            onClick: manejarPago,\n            children: \"Proceder al pago\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 15\n          }, this), mensajeFinal && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mensaje-confirmacion\",\n            children: mensajeFinal\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 32\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(CarritoPage, \"RjcOrHHrvmZKjRAv5D66OGG28EQ=\");\n_c = CarritoPage;\nvar _c;\n$RefreshReg$(_c, \"CarritoPage\");","map":{"version":3,"names":["React","useEffect","useState","Navbar","jsxDEV","_jsxDEV","Fragment","_Fragment","CarritoPage","_s","_metodos$find","carrito","setCarrito","direcciones","setDirecciones","direccion","setDireccion","nombre","calle","ciudad","estado","cp","telefono","referencia","direccionGuardada","setDireccionGuardada","mensajeDireccion","setMensajeDireccion","metodos","setMetodos","metodoPago","setMetodoPago","detallesPago","setDetallesPago","numero","expiracion","cvv","email","pagoGuardado","setPagoGuardado","mensajePago","setMensajePago","mensajeFinal","setMensajeFinal","token","localStorage","getItem","API","fetch","headers","Authorization","then","r","json","catch","console","error","dirs","length","d","nombre_recibe","mps","m","id","toString","tipo","titular","children","fileName","_jsxFileName","lineNumber","columnNumber","cambiarCantidad","qty","method","body","JSON","stringify","cantidad","eliminarItem","total","detalles","reduce","sum","producto","precio_unitario","guardarDireccion","alert","res","ok","Error","msg","ds","e","message","guardarMetodoPago","isNaN","payload","token_last4","slice","ms","manejarPago","_direcciones$find","direccionId","find","metodoPagoId","className","map","src","imagen_url","alt","toLocaleString","type","min","value","onChange","target","onClick","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/cesar/OneDrive/Documentos/GitHub/muebleria-app/frontend/src/pages/CarritoPage.jsx"],"sourcesContent":["// src/pages/CarritoPage.jsx\r\nimport React, { useEffect, useState } from 'react'\r\nimport Navbar from '../components/Auth/Navbar'\r\nimport './CarritoPage.css'\r\n\r\nexport default function CarritoPage() {\r\n  const [carrito, setCarrito] = useState(null)\r\n\r\n  // — DIRECCIONES —\r\n  const [direcciones, setDirecciones] = useState([])\r\n  const [direccion, setDireccion]   = useState({\r\n    nombre: '', calle: '', ciudad: '', estado: '', cp: '', telefono: '', referencia: ''\r\n  })\r\n  const [direccionGuardada, setDireccionGuardada] = useState(false)\r\n  const [mensajeDireccion, setMensajeDireccion]   = useState('')\r\n\r\n  // — MÉTODOS DE PAGO —\r\n  const [metodos, setMetodos]       = useState([])\r\n  const [metodoPago, setMetodoPago] = useState('')\r\n  const [detallesPago, setDetallesPago] = useState({\r\n    numero: '', expiracion: '', cvv: '', email: ''\r\n  })\r\n  const [pagoGuardado, setPagoGuardado] = useState(false)\r\n  const [mensajePago, setMensajePago]   = useState('')\r\n\r\n  // — ESTADO GENERAL —\r\n  const [mensajeFinal, setMensajeFinal] = useState('')\r\n  const token = localStorage.getItem('token')\r\n  const API   = 'http://localhost:4000/api'\r\n\r\n  // al montar: traemos carrito, direcciones y métodos\r\n  useEffect(() => {\r\n    // 1) Carrito\r\n    fetch(`${API}/carrito`, {\r\n      headers: { Authorization: `Bearer ${token}` }\r\n    })\r\n      .then(r => r.json())\r\n      .then(setCarrito)\r\n      .catch(console.error)\r\n\r\n    // 2) Direcciones\r\n    fetch(`${API}/direcciones`, {\r\n      headers: { Authorization: `Bearer ${token}` }\r\n    })\r\n      .then(r => r.json())\r\n      .then(dirs => {\r\n        setDirecciones(dirs || [])\r\n        if (dirs.length) {\r\n          const d = dirs[0]\r\n          setDireccion({\r\n            nombre:    d.nombre_recibe,\r\n            calle:     d.calle,\r\n            ciudad:    d.ciudad,\r\n            estado:    d.estado,\r\n            cp:        d.cp,\r\n            telefono:  d.telefono,\r\n            referencia:d.referencia || ''\r\n          })\r\n          setDireccionGuardada(true)\r\n          setMensajeDireccion('📦 Dirección cargada del servidor.')\r\n        }\r\n      })\r\n      .catch(console.error)\r\n\r\n    // 3) Métodos de pago\r\n    fetch(`${API}/metodos`, {\r\n      headers: { Authorization: `Bearer ${token}` }\r\n    })\r\n      .then(r => r.json())\r\n      .then(mps => {\r\n        setMetodos(mps || [])\r\n        if (mps.length) {\r\n          const m = mps[0]\r\n          setMetodoPago(m.id.toString())\r\n          if (m.tipo === 'tarjeta') {\r\n            setDetallesPago({\r\n              numero:     m.titular,\r\n              expiracion: '',\r\n              cvv:        '',\r\n              email:      ''\r\n            })\r\n          } else {\r\n            setDetallesPago({\r\n              numero:     '',\r\n              expiracion: '',\r\n              cvv:        '',\r\n              email:      m.titular || ''\r\n            })\r\n          }\r\n          setPagoGuardado(true)\r\n          setMensajePago('💳 Método de pago cargado del servidor.')\r\n        }\r\n      })\r\n      .catch(console.error)\r\n\r\n  }, [])\r\n\r\n  if (!carrito) return <p>Cargando carrito…</p>\r\n\r\n  // — Funciones de carrito —\r\n  const cambiarCantidad = (id, qty) => {\r\n    fetch(`${API}/carrito/detalle/${id}`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type':'application/json',\r\n        Authorization: `Bearer ${token}`\r\n      },\r\n      body: JSON.stringify({ cantidad: qty })\r\n    })\r\n      .then(() => fetch(`${API}/carrito`, { headers: { Authorization: `Bearer ${token}` } })\r\n        .then(r=>r.json()).then(setCarrito)\r\n      )\r\n      .catch(console.error)\r\n  }\r\n  const eliminarItem = id => cambiarCantidad(id, 0)\r\n\r\n  // — Total —\r\n  const total = carrito.detalles.reduce(\r\n    (sum, d) => sum + d.producto.precio_unitario * d.cantidad,\r\n    0\r\n  )\r\n\r\n  // — Guardar dirección —\r\n  const guardarDireccion = async () => {\r\n    if (!direccion.nombre || !direccion.calle || !direccion.ciudad || !direccion.cp) {\r\n      return alert('Por favor completa nombre, calle, ciudad y código postal.')\r\n    }\r\n    try {\r\n      const res = await fetch(`${API}/direcciones`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type':'application/json',\r\n          Authorization: `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          nombre_recibe: direccion.nombre,\r\n          calle:         direccion.calle,\r\n          ciudad:        direccion.ciudad,\r\n          estado:        direccion.estado,\r\n          cp:            direccion.cp,\r\n          telefono:      direccion.telefono,\r\n          referencia:    direccion.referencia\r\n        })\r\n      })\r\n      const body = await res.json()\r\n      if (!res.ok) throw new Error(body.msg||'Error guardando dirección')\r\n      setDireccionGuardada(true)\r\n      setMensajeDireccion('📦 Dirección guardada en el servidor.')\r\n      // recargar lista\r\n      setDirecciones(ds=>[...ds, body])\r\n    } catch (e) {\r\n      alert('❌ ' + e.message)\r\n    }\r\n  }\r\n\r\n  // — Guardar método de pago / agregar nueva tarjeta —\r\n  const guardarMetodoPago = async () => {\r\n    if (!metodoPago) return alert('Selecciona un método de pago.')\r\n    // si seleccionó uno existente (id numérico), no creamos\r\n    if (!isNaN(+metodoPago)) {\r\n      setPagoGuardado(true)\r\n      setMensajePago('💳 Método de pago seleccionado.')\r\n      return\r\n    }\r\n    // si métodoPago === 'nueva_tarjeta'\r\n    const { numero, expiracion, cvv } = detallesPago\r\n    if (!numero || !expiracion || !cvv) {\r\n      return alert('Completa los datos de la tarjeta.')\r\n    }\r\n    const payload = {\r\n      tipo:        'tarjeta',\r\n      token_last4: numero.slice(-4),\r\n      titular:     numero\r\n    }\r\n    try {\r\n      const res = await fetch(`${API}/metodos`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type':'application/json',\r\n          Authorization: `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify(payload)\r\n      })\r\n      const body = await res.json()\r\n      if (!res.ok) throw new Error(body.msg||'Error guardando método')\r\n      setPagoGuardado(true)\r\n      setMensajePago('💳 Tarjeta guardada en el servidor.')\r\n      setMetodos(ms=>[...ms, body])\r\n      setMetodoPago(body.id.toString())\r\n    } catch (e) {\r\n      alert('❌ ' + e.message)\r\n    }\r\n  }\r\n\r\n  // — Checkout —\r\n  const manejarPago = async () => {\r\n    if (!direccionGuardada || !pagoGuardado) {\r\n      return alert('Guarda tu dirección y método de pago antes de continuar.')\r\n    }\r\n    try {\r\n      const res = await fetch(`${API}/carrito/checkout`, {\r\n        method: 'POST',\r\n        headers:{\r\n          'Content-Type':'application/json',\r\n          Authorization:`Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          direccionId:   direcciones.find(d=>d.nombre_recibe===direccion.nombre)?.id,\r\n          metodoPagoId:  isNaN(+metodoPago) ? null : +metodoPago\r\n        })\r\n      })\r\n      if (!res.ok) throw new Error('Error en checkout')\r\n      setMensajeFinal('✅ Tu compra se ha procesado correctamente.')\r\n    } catch (e) {\r\n      alert('❌ ' + e.message)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Navbar />\r\n      <div className=\"carrito-container\">\r\n        <h2>🛒 Tu Carrito</h2>\r\n        {carrito.detalles.length===0\r\n          ? <p>Tu carrito está vacío.</p>\r\n          : (\r\n          <>\r\n            {/* Items */}\r\n            <div className=\"carrito-items\">\r\n              {carrito.detalles.map(d=>(\r\n                <div key={d.id} className=\"carrito-item\">\r\n                  <img src={`http://localhost:4000${d.producto.imagen_url}`}\r\n                       alt={d.producto.nombre} />\r\n                  <div className=\"item-info\">\r\n                    <h4>{d.producto.nombre}</h4>\r\n                    <p>${d.producto.precio_unitario.toLocaleString()} MXN</p>\r\n                    <div className=\"cantidad-control\">\r\n                      <label>Cantidad:</label>\r\n                      <input type=\"number\" min=\"1\"\r\n                             value={d.cantidad}\r\n                             onChange={e=>cambiarCantidad(d.id,+e.target.value||1)} />\r\n                    </div>\r\n                    <button className=\"eliminar\" onClick={()=>eliminarItem(d.id)}>\r\n                      Eliminar\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Dirección */}\r\n            <div className=\"direccion-section\">\r\n              <h3>📦 Dirección de envío</h3>\r\n              <input type=\"text\" placeholder=\"Nombre completo\"\r\n                     value={direccion.nombre}\r\n                     onChange={e=>setDireccion({...direccion,nombre:e.target.value})} />\r\n              <input type=\"text\" placeholder=\"Calle\"\r\n                     value={direccion.calle}\r\n                     onChange={e=>setDireccion({...direccion,calle:e.target.value})} />\r\n              <input type=\"text\" placeholder=\"Ciudad\"\r\n                     value={direccion.ciudad}\r\n                     onChange={e=>setDireccion({...direccion,ciudad:e.target.value})} />\r\n              <input type=\"text\" placeholder=\"Estado\"\r\n                     value={direccion.estado}\r\n                     onChange={e=>setDireccion({...direccion,estado:e.target.value})} />\r\n              <input type=\"text\" placeholder=\"Código postal\"\r\n                     value={direccion.cp}\r\n                     onChange={e=>setDireccion({...direccion,cp:e.target.value})} />\r\n              <input type=\"tel\" placeholder=\"Teléfono\"\r\n                     value={direccion.telefono}\r\n                     onChange={e=>setDireccion({...direccion,telefono:e.target.value})} />\r\n              <input type=\"text\" placeholder=\"Referencia (opcional)\"\r\n                     value={direccion.referencia}\r\n                     onChange={e=>setDireccion({...direccion,referencia:e.target.value})} />\r\n              <button className=\"guardar-btn\" onClick={guardarDireccion}>\r\n                Guardar dirección\r\n              </button>\r\n              {mensajeDireccion && <p className=\"mensaje-confirmacion\">{mensajeDireccion}</p>}\r\n            </div>\r\n\r\n            {/* Método de pago */}\r\n            <div className=\"metodo-pago-section\">\r\n              <h3>💳 Método de pago</h3>\r\n              <select value={metodoPago}\r\n                      onChange={e=>{ setMetodoPago(e.target.value); setDetallesPago({numero:'',expiracion:'',cvv:'',email:''}); }}>\r\n                <option value=\"\">Selecciona un método</option>\r\n                {metodos.map(m=>(\r\n                  <option key={m.id} value={m.id}>\r\n                    { m.tipo==='tarjeta'\r\n                        ? `Tarjeta •••• ${m.token_last4}`\r\n                        : m.tipo==='transferencia'\r\n                          ? `PayPal (${m.titular})`\r\n                          : m.tipo }\r\n                  </option>\r\n                ))}\r\n                <option value=\"nueva_tarjeta\">+ Agregar nueva tarjeta</option>\r\n              </select>\r\n\r\n              {metodoPago==='nueva_tarjeta' && (\r\n                <>\r\n                  <input type=\"text\" placeholder=\"Número de tarjeta\"\r\n                         value={detallesPago.numero}\r\n                         onChange={e=>setDetallesPago({...detallesPago,numero:e.target.value})} />\r\n                  <input type=\"text\" placeholder=\"MM/AA\"\r\n                         value={detallesPago.expiracion}\r\n                         onChange={e=>setDetallesPago({...detallesPago,expiracion:e.target.value})} />\r\n                  <input type=\"text\" placeholder=\"CVV\"\r\n                         value={detallesPago.cvv}\r\n                         onChange={e=>setDetallesPago({...detallesPago,cvv:e.target.value})} />\r\n                </>\r\n              )}\r\n\r\n              {metodoPago!=='nueva_tarjeta' && metodoPago!=='' && metodoPago!=='efectivo' && (\r\n                <p>Seleccionado: {metodos.find(m=>m.id.toString()===metodoPago)?.tipo}</p>\r\n              )}\r\n\r\n              <button className=\"guardar-btn\" onClick={guardarMetodoPago}>\r\n                Guardar método de pago\r\n              </button>\r\n              {mensajePago && <p className=\"mensaje-confirmacion\">{mensajePago}</p>}\r\n            </div>\r\n\r\n            {/* Resumen */}\r\n            <div className=\"resumen-carrito\">\r\n              <h3>Total: ${total.toLocaleString()} MXN</h3>\r\n              <button className=\"pago-btn\" onClick={manejarPago}>\r\n                Proceder al pago\r\n              </button>\r\n              {mensajeFinal && <p className=\"mensaje-confirmacion\">{mensajeFinal}</p>}\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,OAAOC,MAAM,MAAM,2BAA2B;AAC9C,OAAO,mBAAmB;AAAA,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE1B,eAAe,SAASC,WAAWA,CAAA,EAAG;EAAAC,EAAA;EAAA,IAAAC,aAAA;EACpC,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGV,QAAQ,CAAC,IAAI,CAAC;;EAE5C;EACA,MAAM,CAACW,WAAW,EAAEC,cAAc,CAAC,GAAGZ,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACa,SAAS,EAAEC,YAAY,CAAC,GAAKd,QAAQ,CAAC;IAC3Ce,MAAM,EAAE,EAAE;IAAEC,KAAK,EAAE,EAAE;IAAEC,MAAM,EAAE,EAAE;IAAEC,MAAM,EAAE,EAAE;IAAEC,EAAE,EAAE,EAAE;IAAEC,QAAQ,EAAE,EAAE;IAAEC,UAAU,EAAE;EACnF,CAAC,CAAC;EACF,MAAM,CAACC,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGvB,QAAQ,CAAC,KAAK,CAAC;EACjE,MAAM,CAACwB,gBAAgB,EAAEC,mBAAmB,CAAC,GAAKzB,QAAQ,CAAC,EAAE,CAAC;;EAE9D;EACA,MAAM,CAAC0B,OAAO,EAAEC,UAAU,CAAC,GAAS3B,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAAC4B,UAAU,EAAEC,aAAa,CAAC,GAAG7B,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAAC8B,YAAY,EAAEC,eAAe,CAAC,GAAG/B,QAAQ,CAAC;IAC/CgC,MAAM,EAAE,EAAE;IAAEC,UAAU,EAAE,EAAE;IAAEC,GAAG,EAAE,EAAE;IAAEC,KAAK,EAAE;EAC9C,CAAC,CAAC;EACF,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGrC,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAACsC,WAAW,EAAEC,cAAc,CAAC,GAAKvC,QAAQ,CAAC,EAAE,CAAC;;EAEpD;EACA,MAAM,CAACwC,YAAY,EAAEC,eAAe,CAAC,GAAGzC,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM0C,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,MAAMC,GAAG,GAAK,2BAA2B;;EAEzC;EACA9C,SAAS,CAAC,MAAM;IACd;IACA+C,KAAK,CAAC,GAAGD,GAAG,UAAU,EAAE;MACtBE,OAAO,EAAE;QAAEC,aAAa,EAAE,UAAUN,KAAK;MAAG;IAC9C,CAAC,CAAC,CACCO,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CACnBF,IAAI,CAACvC,UAAU,CAAC,CAChB0C,KAAK,CAACC,OAAO,CAACC,KAAK,CAAC;;IAEvB;IACAR,KAAK,CAAC,GAAGD,GAAG,cAAc,EAAE;MAC1BE,OAAO,EAAE;QAAEC,aAAa,EAAE,UAAUN,KAAK;MAAG;IAC9C,CAAC,CAAC,CACCO,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CACnBF,IAAI,CAACM,IAAI,IAAI;MACZ3C,cAAc,CAAC2C,IAAI,IAAI,EAAE,CAAC;MAC1B,IAAIA,IAAI,CAACC,MAAM,EAAE;QACf,MAAMC,CAAC,GAAGF,IAAI,CAAC,CAAC,CAAC;QACjBzC,YAAY,CAAC;UACXC,MAAM,EAAK0C,CAAC,CAACC,aAAa;UAC1B1C,KAAK,EAAMyC,CAAC,CAACzC,KAAK;UAClBC,MAAM,EAAKwC,CAAC,CAACxC,MAAM;UACnBC,MAAM,EAAKuC,CAAC,CAACvC,MAAM;UACnBC,EAAE,EAASsC,CAAC,CAACtC,EAAE;UACfC,QAAQ,EAAGqC,CAAC,CAACrC,QAAQ;UACrBC,UAAU,EAACoC,CAAC,CAACpC,UAAU,IAAI;QAC7B,CAAC,CAAC;QACFE,oBAAoB,CAAC,IAAI,CAAC;QAC1BE,mBAAmB,CAAC,oCAAoC,CAAC;MAC3D;IACF,CAAC,CAAC,CACD2B,KAAK,CAACC,OAAO,CAACC,KAAK,CAAC;;IAEvB;IACAR,KAAK,CAAC,GAAGD,GAAG,UAAU,EAAE;MACtBE,OAAO,EAAE;QAAEC,aAAa,EAAE,UAAUN,KAAK;MAAG;IAC9C,CAAC,CAAC,CACCO,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CACnBF,IAAI,CAACU,GAAG,IAAI;MACXhC,UAAU,CAACgC,GAAG,IAAI,EAAE,CAAC;MACrB,IAAIA,GAAG,CAACH,MAAM,EAAE;QACd,MAAMI,CAAC,GAAGD,GAAG,CAAC,CAAC,CAAC;QAChB9B,aAAa,CAAC+B,CAAC,CAACC,EAAE,CAACC,QAAQ,CAAC,CAAC,CAAC;QAC9B,IAAIF,CAAC,CAACG,IAAI,KAAK,SAAS,EAAE;UACxBhC,eAAe,CAAC;YACdC,MAAM,EAAM4B,CAAC,CAACI,OAAO;YACrB/B,UAAU,EAAE,EAAE;YACdC,GAAG,EAAS,EAAE;YACdC,KAAK,EAAO;UACd,CAAC,CAAC;QACJ,CAAC,MAAM;UACLJ,eAAe,CAAC;YACdC,MAAM,EAAM,EAAE;YACdC,UAAU,EAAE,EAAE;YACdC,GAAG,EAAS,EAAE;YACdC,KAAK,EAAOyB,CAAC,CAACI,OAAO,IAAI;UAC3B,CAAC,CAAC;QACJ;QACA3B,eAAe,CAAC,IAAI,CAAC;QACrBE,cAAc,CAAC,yCAAyC,CAAC;MAC3D;IACF,CAAC,CAAC,CACDa,KAAK,CAACC,OAAO,CAACC,KAAK,CAAC;EAEzB,CAAC,EAAE,EAAE,CAAC;EAEN,IAAI,CAAC7C,OAAO,EAAE,oBAAON,OAAA;IAAA8D,QAAA,EAAG;EAAiB;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAG,CAAC;;EAE7C;EACA,MAAMC,eAAe,GAAGA,CAACT,EAAE,EAAEU,GAAG,KAAK;IACnCzB,KAAK,CAAC,GAAGD,GAAG,oBAAoBgB,EAAE,EAAE,EAAE;MACpCW,MAAM,EAAE,KAAK;MACbzB,OAAO,EAAE;QACP,cAAc,EAAC,kBAAkB;QACjCC,aAAa,EAAE,UAAUN,KAAK;MAChC,CAAC;MACD+B,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAEC,QAAQ,EAAEL;MAAI,CAAC;IACxC,CAAC,CAAC,CACCtB,IAAI,CAAC,MAAMH,KAAK,CAAC,GAAGD,GAAG,UAAU,EAAE;MAAEE,OAAO,EAAE;QAAEC,aAAa,EAAE,UAAUN,KAAK;MAAG;IAAE,CAAC,CAAC,CACnFO,IAAI,CAACC,CAAC,IAAEA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CAACF,IAAI,CAACvC,UAAU,CACpC,CAAC,CACA0C,KAAK,CAACC,OAAO,CAACC,KAAK,CAAC;EACzB,CAAC;EACD,MAAMuB,YAAY,GAAGhB,EAAE,IAAIS,eAAe,CAACT,EAAE,EAAE,CAAC,CAAC;;EAEjD;EACA,MAAMiB,KAAK,GAAGrE,OAAO,CAACsE,QAAQ,CAACC,MAAM,CACnC,CAACC,GAAG,EAAExB,CAAC,KAAKwB,GAAG,GAAGxB,CAAC,CAACyB,QAAQ,CAACC,eAAe,GAAG1B,CAAC,CAACmB,QAAQ,EACzD,CACF,CAAC;;EAED;EACA,MAAMQ,gBAAgB,GAAG,MAAAA,CAAA,KAAY;IACnC,IAAI,CAACvE,SAAS,CAACE,MAAM,IAAI,CAACF,SAAS,CAACG,KAAK,IAAI,CAACH,SAAS,CAACI,MAAM,IAAI,CAACJ,SAAS,CAACM,EAAE,EAAE;MAC/E,OAAOkE,KAAK,CAAC,2DAA2D,CAAC;IAC3E;IACA,IAAI;MACF,MAAMC,GAAG,GAAG,MAAMxC,KAAK,CAAC,GAAGD,GAAG,cAAc,EAAE;QAC5C2B,MAAM,EAAE,MAAM;QACdzB,OAAO,EAAE;UACP,cAAc,EAAC,kBAAkB;UACjCC,aAAa,EAAE,UAAUN,KAAK;QAChC,CAAC;QACD+B,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBjB,aAAa,EAAE7C,SAAS,CAACE,MAAM;UAC/BC,KAAK,EAAUH,SAAS,CAACG,KAAK;UAC9BC,MAAM,EAASJ,SAAS,CAACI,MAAM;UAC/BC,MAAM,EAASL,SAAS,CAACK,MAAM;UAC/BC,EAAE,EAAaN,SAAS,CAACM,EAAE;UAC3BC,QAAQ,EAAOP,SAAS,CAACO,QAAQ;UACjCC,UAAU,EAAKR,SAAS,CAACQ;QAC3B,CAAC;MACH,CAAC,CAAC;MACF,MAAMoD,IAAI,GAAG,MAAMa,GAAG,CAACnC,IAAI,CAAC,CAAC;MAC7B,IAAI,CAACmC,GAAG,CAACC,EAAE,EAAE,MAAM,IAAIC,KAAK,CAACf,IAAI,CAACgB,GAAG,IAAE,2BAA2B,CAAC;MACnElE,oBAAoB,CAAC,IAAI,CAAC;MAC1BE,mBAAmB,CAAC,uCAAuC,CAAC;MAC5D;MACAb,cAAc,CAAC8E,EAAE,IAAE,CAAC,GAAGA,EAAE,EAAEjB,IAAI,CAAC,CAAC;IACnC,CAAC,CAAC,OAAOkB,CAAC,EAAE;MACVN,KAAK,CAAC,IAAI,GAAGM,CAAC,CAACC,OAAO,CAAC;IACzB;EACF,CAAC;;EAED;EACA,MAAMC,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IACpC,IAAI,CAACjE,UAAU,EAAE,OAAOyD,KAAK,CAAC,+BAA+B,CAAC;IAC9D;IACA,IAAI,CAACS,KAAK,CAAC,CAAClE,UAAU,CAAC,EAAE;MACvBS,eAAe,CAAC,IAAI,CAAC;MACrBE,cAAc,CAAC,iCAAiC,CAAC;MACjD;IACF;IACA;IACA,MAAM;MAAEP,MAAM;MAAEC,UAAU;MAAEC;IAAI,CAAC,GAAGJ,YAAY;IAChD,IAAI,CAACE,MAAM,IAAI,CAACC,UAAU,IAAI,CAACC,GAAG,EAAE;MAClC,OAAOmD,KAAK,CAAC,mCAAmC,CAAC;IACnD;IACA,MAAMU,OAAO,GAAG;MACdhC,IAAI,EAAS,SAAS;MACtBiC,WAAW,EAAEhE,MAAM,CAACiE,KAAK,CAAC,CAAC,CAAC,CAAC;MAC7BjC,OAAO,EAAMhC;IACf,CAAC;IACD,IAAI;MACF,MAAMsD,GAAG,GAAG,MAAMxC,KAAK,CAAC,GAAGD,GAAG,UAAU,EAAE;QACxC2B,MAAM,EAAE,MAAM;QACdzB,OAAO,EAAE;UACP,cAAc,EAAC,kBAAkB;UACjCC,aAAa,EAAE,UAAUN,KAAK;QAChC,CAAC;QACD+B,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACoB,OAAO;MAC9B,CAAC,CAAC;MACF,MAAMtB,IAAI,GAAG,MAAMa,GAAG,CAACnC,IAAI,CAAC,CAAC;MAC7B,IAAI,CAACmC,GAAG,CAACC,EAAE,EAAE,MAAM,IAAIC,KAAK,CAACf,IAAI,CAACgB,GAAG,IAAE,wBAAwB,CAAC;MAChEpD,eAAe,CAAC,IAAI,CAAC;MACrBE,cAAc,CAAC,qCAAqC,CAAC;MACrDZ,UAAU,CAACuE,EAAE,IAAE,CAAC,GAAGA,EAAE,EAAEzB,IAAI,CAAC,CAAC;MAC7B5C,aAAa,CAAC4C,IAAI,CAACZ,EAAE,CAACC,QAAQ,CAAC,CAAC,CAAC;IACnC,CAAC,CAAC,OAAO6B,CAAC,EAAE;MACVN,KAAK,CAAC,IAAI,GAAGM,CAAC,CAACC,OAAO,CAAC;IACzB;EACF,CAAC;;EAED;EACA,MAAMO,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,IAAI,CAAC7E,iBAAiB,IAAI,CAACc,YAAY,EAAE;MACvC,OAAOiD,KAAK,CAAC,0DAA0D,CAAC;IAC1E;IACA,IAAI;MAAA,IAAAe,iBAAA;MACF,MAAMd,GAAG,GAAG,MAAMxC,KAAK,CAAC,GAAGD,GAAG,mBAAmB,EAAE;QACjD2B,MAAM,EAAE,MAAM;QACdzB,OAAO,EAAC;UACN,cAAc,EAAC,kBAAkB;UACjCC,aAAa,EAAC,UAAUN,KAAK;QAC/B,CAAC;QACD+B,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnB0B,WAAW,GAAAD,iBAAA,GAAIzF,WAAW,CAAC2F,IAAI,CAAC7C,CAAC,IAAEA,CAAC,CAACC,aAAa,KAAG7C,SAAS,CAACE,MAAM,CAAC,cAAAqF,iBAAA,uBAAvDA,iBAAA,CAAyDvC,EAAE;UAC1E0C,YAAY,EAAGT,KAAK,CAAC,CAAClE,UAAU,CAAC,GAAG,IAAI,GAAG,CAACA;QAC9C,CAAC;MACH,CAAC,CAAC;MACF,IAAI,CAAC0D,GAAG,CAACC,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,mBAAmB,CAAC;MACjD/C,eAAe,CAAC,4CAA4C,CAAC;IAC/D,CAAC,CAAC,OAAOkD,CAAC,EAAE;MACVN,KAAK,CAAC,IAAI,GAAGM,CAAC,CAACC,OAAO,CAAC;IACzB;EACF,CAAC;EAED,oBACEzF,OAAA,CAAAE,SAAA;IAAA4D,QAAA,gBACE9D,OAAA,CAACF,MAAM;MAAAiE,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACVlE,OAAA;MAAKqG,SAAS,EAAC,mBAAmB;MAAAvC,QAAA,gBAChC9D,OAAA;QAAA8D,QAAA,EAAI;MAAa;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,EACrB5D,OAAO,CAACsE,QAAQ,CAACvB,MAAM,KAAG,CAAC,gBACxBrD,OAAA;QAAA8D,QAAA,EAAG;MAAsB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC,gBAE/BlE,OAAA,CAAAE,SAAA;QAAA4D,QAAA,gBAEE9D,OAAA;UAAKqG,SAAS,EAAC,eAAe;UAAAvC,QAAA,EAC3BxD,OAAO,CAACsE,QAAQ,CAAC0B,GAAG,CAAChD,CAAC,iBACrBtD,OAAA;YAAgBqG,SAAS,EAAC,cAAc;YAAAvC,QAAA,gBACtC9D,OAAA;cAAKuG,GAAG,EAAE,wBAAwBjD,CAAC,CAACyB,QAAQ,CAACyB,UAAU,EAAG;cACrDC,GAAG,EAAEnD,CAAC,CAACyB,QAAQ,CAACnE;YAAO;cAAAmD,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eAC/BlE,OAAA;cAAKqG,SAAS,EAAC,WAAW;cAAAvC,QAAA,gBACxB9D,OAAA;gBAAA8D,QAAA,EAAKR,CAAC,CAACyB,QAAQ,CAACnE;cAAM;gBAAAmD,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAK,CAAC,eAC5BlE,OAAA;gBAAA8D,QAAA,GAAG,GAAC,EAACR,CAAC,CAACyB,QAAQ,CAACC,eAAe,CAAC0B,cAAc,CAAC,CAAC,EAAC,MAAI;cAAA;gBAAA3C,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAG,CAAC,eACzDlE,OAAA;gBAAKqG,SAAS,EAAC,kBAAkB;gBAAAvC,QAAA,gBAC/B9D,OAAA;kBAAA8D,QAAA,EAAO;gBAAS;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAO,CAAC,eACxBlE,OAAA;kBAAO2G,IAAI,EAAC,QAAQ;kBAACC,GAAG,EAAC,GAAG;kBACrBC,KAAK,EAAEvD,CAAC,CAACmB,QAAS;kBAClBqC,QAAQ,EAAEtB,CAAC,IAAErB,eAAe,CAACb,CAAC,CAACI,EAAE,EAAC,CAAC8B,CAAC,CAACuB,MAAM,CAACF,KAAK,IAAE,CAAC;gBAAE;kBAAA9C,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC7D,CAAC,eACNlE,OAAA;gBAAQqG,SAAS,EAAC,UAAU;gBAACW,OAAO,EAAEA,CAAA,KAAItC,YAAY,CAACpB,CAAC,CAACI,EAAE,CAAE;gBAAAI,QAAA,EAAC;cAE9D;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACN,CAAC;UAAA,GAfEZ,CAAC,CAACI,EAAE;YAAAK,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAgBT,CACN;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACC,CAAC,eAGNlE,OAAA;UAAKqG,SAAS,EAAC,mBAAmB;UAAAvC,QAAA,gBAChC9D,OAAA;YAAA8D,QAAA,EAAI;UAAqB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eAC9BlE,OAAA;YAAO2G,IAAI,EAAC,MAAM;YAACM,WAAW,EAAC,iBAAiB;YACzCJ,KAAK,EAAEnG,SAAS,CAACE,MAAO;YACxBkG,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACE,MAAM,EAAC4E,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC1ElE,OAAA;YAAO2G,IAAI,EAAC,MAAM;YAACM,WAAW,EAAC,OAAO;YAC/BJ,KAAK,EAAEnG,SAAS,CAACG,KAAM;YACvBiG,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACG,KAAK,EAAC2E,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eACzElE,OAAA;YAAO2G,IAAI,EAAC,MAAM;YAACM,WAAW,EAAC,QAAQ;YAChCJ,KAAK,EAAEnG,SAAS,CAACI,MAAO;YACxBgG,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACI,MAAM,EAAC0E,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC1ElE,OAAA;YAAO2G,IAAI,EAAC,MAAM;YAACM,WAAW,EAAC,QAAQ;YAChCJ,KAAK,EAAEnG,SAAS,CAACK,MAAO;YACxB+F,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACK,MAAM,EAACyE,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC1ElE,OAAA;YAAO2G,IAAI,EAAC,MAAM;YAACM,WAAW,EAAC,kBAAe;YACvCJ,KAAK,EAAEnG,SAAS,CAACM,EAAG;YACpB8F,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACM,EAAE,EAACwE,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eACtElE,OAAA;YAAO2G,IAAI,EAAC,KAAK;YAACM,WAAW,EAAC,aAAU;YACjCJ,KAAK,EAAEnG,SAAS,CAACO,QAAS;YAC1B6F,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACO,QAAQ,EAACuE,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC5ElE,OAAA;YAAO2G,IAAI,EAAC,MAAM;YAACM,WAAW,EAAC,uBAAuB;YAC/CJ,KAAK,EAAEnG,SAAS,CAACQ,UAAW;YAC5B4F,QAAQ,EAAEtB,CAAC,IAAE7E,YAAY,CAAC;cAAC,GAAGD,SAAS;cAACQ,UAAU,EAACsE,CAAC,CAACuB,MAAM,CAACF;YAAK,CAAC;UAAE;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC9ElE,OAAA;YAAQqG,SAAS,EAAC,aAAa;YAACW,OAAO,EAAE/B,gBAAiB;YAAAnB,QAAA,EAAC;UAE3D;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,EACR7C,gBAAgB,iBAAIrB,OAAA;YAAGqG,SAAS,EAAC,sBAAsB;YAAAvC,QAAA,EAAEzC;UAAgB;YAAA0C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC5E,CAAC,eAGNlE,OAAA;UAAKqG,SAAS,EAAC,qBAAqB;UAAAvC,QAAA,gBAClC9D,OAAA;YAAA8D,QAAA,EAAI;UAAiB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eAC1BlE,OAAA;YAAQ6G,KAAK,EAAEpF,UAAW;YAClBqF,QAAQ,EAAEtB,CAAC,IAAE;cAAE9D,aAAa,CAAC8D,CAAC,CAACuB,MAAM,CAACF,KAAK,CAAC;cAAEjF,eAAe,CAAC;gBAACC,MAAM,EAAC,EAAE;gBAACC,UAAU,EAAC,EAAE;gBAACC,GAAG,EAAC,EAAE;gBAACC,KAAK,EAAC;cAAE,CAAC,CAAC;YAAE,CAAE;YAAA8B,QAAA,gBAClH9D,OAAA;cAAQ6G,KAAK,EAAC,EAAE;cAAA/C,QAAA,EAAC;YAAoB;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,EAC7C3C,OAAO,CAAC+E,GAAG,CAAC7C,CAAC,iBACZzD,OAAA;cAAmB6G,KAAK,EAAEpD,CAAC,CAACC,EAAG;cAAAI,QAAA,EAC3BL,CAAC,CAACG,IAAI,KAAG,SAAS,GACd,gBAAgBH,CAAC,CAACoC,WAAW,EAAE,GAC/BpC,CAAC,CAACG,IAAI,KAAG,eAAe,GACtB,WAAWH,CAAC,CAACI,OAAO,GAAG,GACvBJ,CAAC,CAACG;YAAI,GALHH,CAAC,CAACC,EAAE;cAAAK,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAMT,CACT,CAAC,eACFlE,OAAA;cAAQ6G,KAAK,EAAC,eAAe;cAAA/C,QAAA,EAAC;YAAuB;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACxD,CAAC,EAERzC,UAAU,KAAG,eAAe,iBAC3BzB,OAAA,CAAAE,SAAA;YAAA4D,QAAA,gBACE9D,OAAA;cAAO2G,IAAI,EAAC,MAAM;cAACM,WAAW,EAAC,sBAAmB;cAC3CJ,KAAK,EAAElF,YAAY,CAACE,MAAO;cAC3BiF,QAAQ,EAAEtB,CAAC,IAAE5D,eAAe,CAAC;gBAAC,GAAGD,YAAY;gBAACE,MAAM,EAAC2D,CAAC,CAACuB,MAAM,CAACF;cAAK,CAAC;YAAE;cAAA9C,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eAChFlE,OAAA;cAAO2G,IAAI,EAAC,MAAM;cAACM,WAAW,EAAC,OAAO;cAC/BJ,KAAK,EAAElF,YAAY,CAACG,UAAW;cAC/BgF,QAAQ,EAAEtB,CAAC,IAAE5D,eAAe,CAAC;gBAAC,GAAGD,YAAY;gBAACG,UAAU,EAAC0D,CAAC,CAACuB,MAAM,CAACF;cAAK,CAAC;YAAE;cAAA9C,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eACpFlE,OAAA;cAAO2G,IAAI,EAAC,MAAM;cAACM,WAAW,EAAC,KAAK;cAC7BJ,KAAK,EAAElF,YAAY,CAACI,GAAI;cACxB+E,QAAQ,EAAEtB,CAAC,IAAE5D,eAAe,CAAC;gBAAC,GAAGD,YAAY;gBAACI,GAAG,EAACyD,CAAC,CAACuB,MAAM,CAACF;cAAK,CAAC;YAAE;cAAA9C,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC;UAAA,eAC7E,CACH,EAEAzC,UAAU,KAAG,eAAe,IAAIA,UAAU,KAAG,EAAE,IAAIA,UAAU,KAAG,UAAU,iBACzEzB,OAAA;YAAA8D,QAAA,GAAG,gBAAc,GAAAzD,aAAA,GAACkB,OAAO,CAAC4E,IAAI,CAAC1C,CAAC,IAAEA,CAAC,CAACC,EAAE,CAACC,QAAQ,CAAC,CAAC,KAAGlC,UAAU,CAAC,cAAApB,aAAA,uBAA7CA,aAAA,CAA+CuD,IAAI;UAAA;YAAAG,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAC1E,eAEDlE,OAAA;YAAQqG,SAAS,EAAC,aAAa;YAACW,OAAO,EAAEtB,iBAAkB;YAAA5B,QAAA,EAAC;UAE5D;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,EACR/B,WAAW,iBAAInC,OAAA;YAAGqG,SAAS,EAAC,sBAAsB;YAAAvC,QAAA,EAAE3B;UAAW;YAAA4B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClE,CAAC,eAGNlE,OAAA;UAAKqG,SAAS,EAAC,iBAAiB;UAAAvC,QAAA,gBAC9B9D,OAAA;YAAA8D,QAAA,GAAI,UAAQ,EAACa,KAAK,CAAC+B,cAAc,CAAC,CAAC,EAAC,MAAI;UAAA;YAAA3C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eAC7ClE,OAAA;YAAQqG,SAAS,EAAC,UAAU;YAACW,OAAO,EAAEhB,WAAY;YAAAlC,QAAA,EAAC;UAEnD;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,EACR7B,YAAY,iBAAIrC,OAAA;YAAGqG,SAAS,EAAC,sBAAsB;YAAAvC,QAAA,EAAEzB;UAAY;YAAA0B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpE,CAAC;MAAA,eACN,CACH;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC;EAAA,eACN,CAAC;AAEP;AAAC9D,EAAA,CA1UuBD,WAAW;AAAA+G,EAAA,GAAX/G,WAAW;AAAA,IAAA+G,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}